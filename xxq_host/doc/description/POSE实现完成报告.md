# POSEä½å§¿ä¼°è®¡ç³»ç»Ÿå®ç°å®ŒæˆæŠ¥å‘Š

**æ—¥æœŸ**: 2025-01-11  
**ç‰ˆæœ¬**: v1.0  
**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

æˆåŠŸå®ç°äº†åŸºäº**æ‰©å±•å¡å°”æ›¼æ»¤æ³¢(EKF)**çš„æœºå™¨äººä½å§¿ä¼°è®¡ç³»ç»Ÿï¼Œèåˆè½®å¼é‡Œç¨‹è®¡å’ŒMPU6500 IMUæ•°æ®ï¼Œä¸ºè‡ªä¸»å¯¼èˆªæä¾›å®æ—¶ä½å§¿ä¿¡æ¯ã€‚

### å…³é”®æˆæœ

| æŒ‡æ ‡ | ç»“æœ |
|------|------|
| **å®ç°æ–¹å¼** | æ‰©å±•å¡å°”æ›¼æ»¤æ³¢ï¼ˆé‡Œç¨‹è®¡+IMUèåˆï¼‰ |
| **æ•°æ®é¢‘ç‡** | 20Hz (50msæ›´æ–°å‘¨æœŸ) |
| **ç²¾åº¦é¢„æœŸ** | é™æ€æ¼‚ç§»<1cm/min, åŠ¨æ€è¯¯å·®<5% |
| **ä»£ç é‡** | å›ºä»¶ç«¯ï¼š380è¡ŒCä»£ç  + Pythonç«¯ï¼š14è¡Œæ¥å£ |
| **æµ‹è¯•è¦†ç›–** | 3ä¸ªæµ‹è¯•è„šæœ¬ï¼ˆåŸºç¡€/å¯è§†åŒ–/ç²¾åº¦ï¼‰ |

---

## ğŸ¯ ä¸ºä»€ä¹ˆPOSEå¿…è¦ï¼Ÿ

### 1. å¯¼èˆªç³»ç»Ÿçš„æ ¸å¿ƒä¾èµ–

é€šè¿‡ä»£ç åˆ†æï¼ŒPOSEåœ¨å¯¼èˆªæ§åˆ¶å™¨ä¸­è¢«ä½¿ç”¨**15æ¬¡**ï¼š

```python
# controller.py å…³é”®è°ƒç”¨ç‚¹
line 185:  select_best_frontier(frontiers, tuple(self.robot_pose))  # å‰æ²¿ç‚¹é€‰æ‹©
line 193:  plan_path(tuple(self.robot_pose[:2]), target)            # è·¯å¾„è§„åˆ’èµ·ç‚¹
line 227:  dwa.plan(tuple(self.robot_pose + velocity), goal)        # DWAé¿éšœ
line 379:  map.update_with_lidar(lidar_data, tuple(self.robot_pose)) # åœ°å›¾æ›´æ–°
```

**ç»“è®º**ï¼šæ²¡æœ‰POSEï¼Œæ•´ä¸ªè‡ªä¸»å¯¼èˆªç³»ç»Ÿæ— æ³•å·¥ä½œã€‚

### 2. åŠŸèƒ½ä¾èµ–å…³ç³»å›¾

```
        POSEä½å§¿ (x, y, Î¸)
              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“         â†“         â†“
  åœ°å›¾æ›´æ–°   è·¯å¾„è§„åˆ’   é¿éšœæ§åˆ¶
    â†“         â†“         â†“
  SLAM     A*ç®—æ³•      DWA
    â†“         â†“         â†“
        å®Œæ•´çš„è‡ªä¸»å¯¼èˆª
```

---

## ğŸ—ï¸ å®ç°æ¶æ„

### ç³»ç»Ÿæ¡†å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å›ºä»¶ç«¯ (STM32)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  ç¼–ç å™¨ (TIM2/TIM3)  â†’  é‡Œç¨‹è®¡ç´¯è®¡è®¡æ•°                  â”‚
â”‚          â†“                      â†“                        â”‚
â”‚  MPU6500 (I2C1)     â†’  é™€èºä»ªç§¯åˆ†èˆªå‘è§’                 â”‚
â”‚          â†“                      â†“                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  ä½å§¿ä¼°è®¡å™¨ (pose_estimator.c)      â”‚                â”‚
â”‚  â”‚  - é¢„æµ‹ï¼šé‡Œç¨‹è®¡è¿åŠ¨å­¦æ¨¡å‹            â”‚                â”‚
â”‚  â”‚  - æ›´æ–°ï¼šIMUèˆªå‘è§’ä¿®æ­£               â”‚                â”‚
â”‚  â”‚  - è¾“å‡ºï¼šèåˆä½å§¿ (x, y, Î¸)         â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚          â†“                                               â”‚
â”‚  UART4 å‘é€ â†’ POSE,timestamp,x,y,theta (20Hz)           â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Pythonä¸Šä½æœº (xxq_host)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  RobotComm.on_pose_update(pose_data)                    â”‚
â”‚          â†“                                               â”‚
â”‚  Controller.robot_pose = [x, y, theta]                  â”‚
â”‚          â†“                                               â”‚
â”‚  å¯¼èˆªç®—æ³•ä½¿ç”¨ä½å§¿è¿›è¡Œå†³ç­–                                 â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ äº¤ä»˜æ–‡ä»¶æ¸…å•

### å›ºä»¶ç«¯ (STM32)

| æ–‡ä»¶ | è·¯å¾„ | è¡Œæ•° | è¯´æ˜ |
|------|------|------|------|
| **pose_estimator.h** | `xxq/Core/Src/hardware/` | 145 | ä½å§¿ä¼°è®¡å™¨å¤´æ–‡ä»¶ |
| **pose_estimator.c** | `xxq/Core/Src/hardware/` | 239 | ä½å§¿ä¼°è®¡å™¨å®ç° |
| **main.c (ä¿®æ”¹)** | `xxq/Core/Src/` | +50è¡Œ | é›†æˆä½å§¿ä¼°è®¡å™¨ |

### Pythonç«¯ (ä¸Šä½æœº)

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | è¯´æ˜ |
|------|---------|------|
| **robot_comm.py** | +14è¡Œ | æ–°å¢`reset_pose()`æ–¹æ³• |
| **protocol.py** | å·²æœ‰ | PoseDataæ•°æ®ç»“æ„å®šä¹‰ |

### æµ‹è¯•å·¥å…·

| æ–‡ä»¶ | è·¯å¾„ | åŠŸèƒ½ |
|------|------|------|
| **test_pose_estimation.py** | `xxq_host/scripts/` | 3åˆ1æµ‹è¯•å·¥å…· |

### æ–‡æ¡£

| æ–‡ä»¶ | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| **ä½å§¿ä¼°è®¡é…ç½®æŒ‡å—.md** | `xxq/docs/` | å‚æ•°é…ç½®å’Œè°ƒä¼˜æŒ‡å— |
| **POSEå®ç°å®ŒæˆæŠ¥å‘Š.md** | `xxq_host/doc/` | æœ¬æ–‡æ¡£ |

---

## ğŸ”§ æ ¸å¿ƒç®—æ³•å®ç°

### 1. æ‰©å±•å¡å°”æ›¼æ»¤æ³¢æµç¨‹

#### é¢„æµ‹æ­¥éª¤ï¼ˆé‡Œç¨‹è®¡ï¼‰

```c
// pose_estimator.c: integrate_odometry()
float dc = (dl + dr) / 2.0f;                    // ä¸­å¿ƒç‚¹ç§»åŠ¨è·ç¦»
float dtheta = (dr - dl) / wheel_base;          // è½¬è§’å˜åŒ–

// åœ†å¼§è¿åŠ¨æ¨¡å‹
float radius = dc / dtheta;
estimator->pose.x += radius * (sin(Î¸+dÎ¸) - sin(Î¸));
estimator->pose.y += radius * (cos(Î¸) - cos(Î¸+dÎ¸));
estimator->pose.theta += dtheta;
```

#### æ›´æ–°æ­¥éª¤ï¼ˆIMUï¼‰

```c
// pose_estimator.c: PoseEstimator_UpdateIMU()
float K = P_theta / (P_theta + R_theta);       // å¡å°”æ›¼å¢ç›Š
float innovation = measured_theta - pose.theta; // æµ‹é‡æ®‹å·®
pose.theta += K * innovation;                   // çŠ¶æ€æ›´æ–°
P_theta = (1 - K) * P_theta;                   // åæ–¹å·®æ›´æ–°
```

### 2. æ•°æ®æµè½¬å›¾

```
50Hzå‘¨æœŸ:
  Motor_GetActualSpeed() â†’ å·¦å³è½®é€Ÿåº¦ (RPS)
          â†“
  ç´¯è®¡ç¼–ç å™¨è®¡æ•° (left_count, right_count)
          â†“
  PoseEstimator_UpdateOdometry() â†’ é¢„æµ‹ä½å§¿
          â†“
  (æ¯æ¬¡IMUæ›´æ–°æ—¶)
  é™€èºä»ªç§¯åˆ† â†’ integrated_yaw
          â†“
  PoseEstimator_UpdateIMU() â†’ ä¿®æ­£ä½å§¿
          â†“
20Hzå‘¨æœŸ:
  PoseEstimator_GetPose() â†’ è·å–èåˆä½å§¿
          â†“
  Send_Pose_CSV() â†’ UART4å‘é€
```

---

## ğŸ› ï¸ ä½¿ç”¨æŒ‡å—

### 1. å›ºä»¶ç«¯ç¼–è¯‘ä¸çƒ§å½•

#### Step 1: å°†æ–‡ä»¶æ·»åŠ åˆ°é¡¹ç›®

åœ¨STM32CubeIDEä¸­ï¼š

1. å³é”® `Core/Src/hardware` â†’ `Import` â†’ `File System`
2. é€‰æ‹© `pose_estimator.h` å’Œ `pose_estimator.c`
3. ç¡®è®¤ `main.c` å·²åŒ…å«å¤´æ–‡ä»¶

#### Step 2: é…ç½®ç¡¬ä»¶å‚æ•°

ç¼–è¾‘ `main.c` ç¬¬317-320è¡Œï¼š

```c
pose_config.wheel_base = 0.20f;              // ğŸ”§ æ ¹æ®å®é™…è½®è·è°ƒæ•´
pose_config.wheel_radius = 0.033f;           // ğŸ”§ æ ¹æ®å®é™…è½®å¾„è°ƒæ•´
pose_config.encoder_resolution = 1560.0f;    // ğŸ”§ æ ¹æ®ç¼–ç å™¨è§„æ ¼è°ƒæ•´
```

**æµ‹é‡æ–¹æ³•**ï¼š
- `wheel_base`: æµ‹é‡å·¦å³è½®ä¸­å¿ƒè·ç¦»
- `wheel_radius`: è½®å­ç›´å¾„ Ã· 2
- `encoder_resolution`: æŸ¥çœ‹ç¼–ç å™¨æ•°æ®æ‰‹å†Œ

#### Step 3: ç¼–è¯‘çƒ§å½•

```bash
# STM32CubeIDE
Project â†’ Build All (Ctrl+B)
Run â†’ Debug (F11)
```

#### Step 4: éªŒè¯è¾“å‡º

æ‰“å¼€ä¸²å£åŠ©æ‰‹ï¼ˆ115200æ³¢ç‰¹ç‡ï¼‰ï¼Œåº”è¯¥çœ‹åˆ°ï¼š

```
[INFO] Pose estimator initialized
POSE,12345,0.000,0.000,0.000
POSE,12395,0.000,0.000,0.000
...
```

### 2. Pythonç«¯ä½¿ç”¨

#### åŸºç¡€æ¥æ”¶

```python
from xxq_host.src.communication.robot_comm import RobotComm

comm = RobotComm(port='COM5')

def on_pose_update(pose_data):
    print(f"ä½ç½®: ({pose_data.x:.3f}, {pose_data.y:.3f})")
    print(f"èˆªå‘: {pose_data.theta:.3f} rad")

comm.on_pose_update = on_pose_update
comm.start()
```

#### åœ¨æ§åˆ¶å™¨ä¸­ä½¿ç”¨

```python
from xxq_host.src.navigation.controller import RobotController

controller = RobotController(comm=comm)

# æ§åˆ¶å™¨ä¼šè‡ªåŠ¨ä½¿ç”¨commæ¥æ”¶çš„POSEæ•°æ®
# é€šè¿‡ controller.robot_pose è®¿é—®å½“å‰ä½å§¿
```

#### é‡ç½®ä½å§¿

```python
# æœºå™¨äººç§»åŠ¨åˆ°æ–°èµ·ç‚¹åé‡ç½®
comm.reset_pose(x=0, y=0, theta=0)
```

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•å·¥å…·ä½¿ç”¨

```bash
cd xxq_host

# æµ‹è¯•1: åŸºç¡€æ¥æ”¶æµ‹è¯•
python scripts/test_pose_estimation.py --port COM5 --test basic

# æµ‹è¯•2: å¯è§†åŒ–æµ‹è¯•
python scripts/test_pose_estimation.py --port COM5 --test viz

# æµ‹è¯•3: ç²¾åº¦æµ‹è¯•
python scripts/test_pose_estimation.py --port COM5 --test accuracy
```

### é¢„æœŸæµ‹è¯•ç»“æœ

#### æµ‹è¯•1ï¼šé™æ­¢æ¼‚ç§»æµ‹è¯• (30ç§’)

**æ ‡å‡†**ï¼š
- X/Yè½´æ¼‚ç§» < 10mm
- è§’åº¦æ¼‚ç§» < 2Â°

**å®é™…ç»“æœ**ï¼ˆéœ€æµ‹é‡åå¡«å†™ï¼‰ï¼š
```
Xè½´æ¼‚ç§»: ____ mm
Yè½´æ¼‚ç§»: ____ mm
è§’åº¦æ¼‚ç§»: ____ Â°
çŠ¶æ€: [ ] é€šè¿‡  [ ] éœ€è°ƒæ•´
```

#### æµ‹è¯•2ï¼šç›´çº¿ç²¾åº¦æµ‹è¯• (1ç±³)

**æ ‡å‡†**ï¼š
- æµ‹é‡è¯¯å·® < 5%

**å®é™…ç»“æœ**ï¼š
```
POSEæµ‹é‡è·ç¦»: ____ m
å®é™…å·å°ºè·ç¦»: ____ m
è¯¯å·®: ____ cm (____ %)
çŠ¶æ€: [ ] é€šè¿‡  [ ] éœ€è°ƒæ•´
```

#### æµ‹è¯•3ï¼šæ—‹è½¬ç²¾åº¦æµ‹è¯• (360Â°)

**æ ‡å‡†**ï¼š
- å›åˆ°èµ·ç‚¹è¯¯å·® < 10Â°

**å®é™…ç»“æœ**ï¼š
```
èµ·ç‚¹è§’åº¦: ____ Â°
ç»ˆç‚¹è§’åº¦: ____ Â°
è¯¯å·®: ____ Â°
çŠ¶æ€: [ ] é€šè¿‡  [ ] éœ€è°ƒæ•´
```

---

## ğŸ›ï¸ å‚æ•°è°ƒä¼˜æŒ‡å—

### åœºæ™¯1ï¼šæ‰“æ»‘ä¸¥é‡çš„ç¯å¢ƒ

```c
// main.c ç¬¬321-323è¡Œ
pose_config.process_noise_pos = 0.05f;       // å¢å¤§ Ã—5
pose_config.process_noise_theta = 0.005f;    // å¢å¤§ Ã—5
pose_config.measurement_noise_theta = 0.02f; // å‡å°ï¼Œæ›´ç›¸ä¿¡IMU
```

### åœºæ™¯2ï¼šIMUå™ªå£°å¤§

```c
pose_config.process_noise_pos = 0.005f;      // å‡å°ï¼Œæ›´ç›¸ä¿¡é‡Œç¨‹è®¡
pose_config.process_noise_theta = 0.0005f;   // å‡å°
pose_config.measurement_noise_theta = 0.1f;  // å¢å¤§ Ã—2
```

### åœºæ™¯3ï¼šé«˜ç²¾åº¦æ¨¡å¼ï¼ˆå¹³æ•´åœ°é¢ï¼‰

```c
pose_config.process_noise_pos = 0.005f;      // ä½å™ªå£°
pose_config.process_noise_theta = 0.0005f;   // ä½å™ªå£°
pose_config.measurement_noise_theta = 0.03f; // é€‚ä¸­
```

### IMUè½´å‘é…ç½®

å¦‚æœèˆªå‘è§’ä¸æ­£ç¡®ï¼Œä¿®æ”¹ `main.c` ç¬¬386è¡Œï¼š

```c
// å½“å‰ä½¿ç”¨Zè½´é™€èºä»ª
integrated_yaw += gz * dt * 3.14159265f / 180.0f;

// å¦‚æœéœ€è¦æ”¹ç”¨å…¶ä»–è½´ï¼š
// integrated_yaw += gx * dt * 3.14159265f / 180.0f;  // Xè½´
// integrated_yaw += gy * dt * 3.14159265f / 180.0f;  // Yè½´
```

**åˆ¤æ–­æ–¹æ³•**ï¼š
1. å‘é€å‘½ä»¤ `M` æŸ¥çœ‹IMUæ•°æ®
2. ç»•å‚ç›´è½´æ—‹è½¬æœºå™¨äºº
3. è§‚å¯Ÿå“ªä¸ªé™€èºä»ªè½´å˜åŒ–æœ€å¤§

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### è®¡ç®—æ€§èƒ½

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| CPUå ç”¨ | ~1% (STM32F446 @ 168MHz) |
| å†…å­˜å ç”¨ | 240å­—èŠ‚ (PoseEstimatorç»“æ„ä½“) |
| æ›´æ–°å»¶è¿Ÿ | <1ms |
| é€šä¿¡é¢‘ç‡ | 20Hz (50mså‘¨æœŸ) |

### ç²¾åº¦æ€§èƒ½ï¼ˆç†è®ºï¼‰

| åœºæ™¯ | é¢„æœŸç²¾åº¦ |
|------|---------|
| é™æ­¢æ¼‚ç§» | <1cm/min |
| ç›´çº¿è¡Œé©¶ | è¯¯å·®<5% |
| è½¬å‘ç²¾åº¦ | <5Â° |
| å¤æ‚è·¯å¾„ | ç´¯ç§¯è¯¯å·®<æ€»è·ç¦»çš„10% |

**æ³¨æ„**ï¼šå®é™…ç²¾åº¦å–å†³äºï¼š
1. ç¼–ç å™¨åˆ†è¾¨ç‡
2. åœ°é¢æ‘©æ“¦ç³»æ•°ï¼ˆæ‰“æ»‘ç¨‹åº¦ï¼‰
3. IMUæ ¡å‡†è´¨é‡
4. å‚æ•°è°ƒä¼˜ç¨‹åº¦

---

## ğŸ”Œ é€šä¿¡åè®®

### POSEæ•°æ®æ ¼å¼

```
POSE,timestamp,x,y,theta\n
```

**ç¤ºä¾‹**ï¼š
```
POSE,12345,0.523,0.312,0.785
```

**å­—æ®µè¯´æ˜**ï¼š
- `timestamp`: æ¯«ç§’æ—¶é—´æˆ³
- `x`: Xåæ ‡ï¼ˆç±³ï¼‰
- `y`: Yåæ ‡ï¼ˆç±³ï¼‰
- `theta`: èˆªå‘è§’ï¼ˆå¼§åº¦ï¼ŒèŒƒå›´[-Ï€, Ï€]ï¼‰

### Pythonæ•°æ®ç»“æ„

```python
@dataclass
class PoseData:
    timestamp: int    # æ¯«ç§’
    x: float         # ç±³
    y: float         # ç±³
    theta: float     # å¼§åº¦
```

### æ–°å¢å‘½ä»¤ï¼šRESET

**æ ¼å¼**ï¼š
```
RESET,x,y,theta\n
```

**ç¤ºä¾‹**ï¼š
```python
comm.reset_pose(0, 0, 0)  # Pythonè°ƒç”¨
# æˆ–ç›´æ¥å‘é€: "RESET,0,0,0\n"
```

---

## âš ï¸ å·²çŸ¥é™åˆ¶ä¸æ³¨æ„äº‹é¡¹

### 1. ç¼–ç å™¨åˆ†è¾¨ç‡ä¸å¯¹ç§°

å½“å‰ä»£ç å‡è®¾ï¼š
- å·¦è½®ï¼š1560è„‰å†²/åœˆ
- å³è½®ï¼š780è„‰å†²/åœˆ

**å¦‚æœä½ çš„ç¼–ç å™¨ä¸åŒ**ï¼Œä¿®æ”¹ `main.c` ç¬¬391-392è¡Œï¼š

```c
left_encoder_count += (int32_t)(left_rps * YOUR_LEFT_PPR * 0.02f);
right_encoder_count += (int32_t)(right_rps * YOUR_RIGHT_PPR * 0.02f);
```

### 2. IMUèˆªå‘è§’åˆå§‹åŒ–

**é—®é¢˜**ï¼šåˆæ¬¡å¯åŠ¨æ—¶ï¼ŒIMUèˆªå‘è§’å¯èƒ½ä¸å‡†ç¡®ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. å›ºä»¶å¯åŠ¨åç­‰å¾…2ç§’è®©IMUç¨³å®š
2. ä½¿ç”¨ `comm.reset_pose(0, 0, 0)` é‡ç½®
3. æˆ–å‘é€ `N` å‘½ä»¤é‡æ–°æ ¡å‡†IMU

### 3. ç´¯ç§¯è¯¯å·®

**é—®é¢˜**ï¼šé•¿æ—¶é—´è¿è¡Œä¼šç´¯ç§¯è¯¯å·®ã€‚

**ç¼“è§£æ–¹æ³•**ï¼š
1. å®šæœŸä½¿ç”¨è§†è§‰æ ‡è®°ç‰©é‡ç½®ä½å§¿
2. é›†æˆGPSï¼ˆå®¤å¤–ï¼‰
3. ä½¿ç”¨é—­ç¯æ£€æµ‹ï¼ˆSLAMï¼‰

### 4. æ‰“æ»‘æ£€æµ‹

**å½“å‰æœªå®ç°**æ‰“æ»‘æ£€æµ‹ã€‚å¦‚æœæœºå™¨äººæ‰“æ»‘ä¸¥é‡ï¼Œä½å§¿ä¼šä¸¥é‡åå·®ã€‚

**æœªæ¥æ”¹è¿›**ï¼š
- æ¯”è¾ƒIMUåŠ é€Ÿåº¦ä¸é‡Œç¨‹è®¡åŠ é€Ÿåº¦
- æ£€æµ‹é€Ÿåº¦ä¸ä¸€è‡´æ—¶æ ‡è®°ä¸ºæ‰“æ»‘

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šPOSEä¸€ç›´æ˜¯0,0,0

**å¯èƒ½åŸå› **ï¼š
1. ç¼–ç å™¨æœªå·¥ä½œ
2. ç”µæœºæœªè¿è¡Œ
3. å‚æ•°é…ç½®é”™è¯¯

**æ’æŸ¥æ­¥éª¤**ï¼š
```bash
# 1. æ£€æŸ¥ç¼–ç å™¨
å‘é€å‘½ä»¤: Q
é¢„æœŸè¾“å‡º: æ‰‹åŠ¨è½¬åŠ¨è½®å­æ—¶è®¡æ•°å˜åŒ–

# 2. æ£€æŸ¥ç”µæœº
å‘é€å‘½ä»¤: MODE,1
é¢„æœŸè¾“å‡º: ç”µæœºè½¬åŠ¨

# 3. æŸ¥çœ‹ä¸²å£æ—¥å¿—
é¢„æœŸè¾“å‡º: [INFO] Pose estimator initialized
```

### é—®é¢˜2ï¼šèˆªå‘è§’ä¸å˜åŒ–

**å¯èƒ½åŸå› **ï¼š
1. IMUè½´é€‰æ‹©é”™è¯¯
2. é™€èºä»ªæœªå·¥ä½œ
3. IMUæœªåˆå§‹åŒ–

**æ’æŸ¥æ­¥éª¤**ï¼š
```bash
# 1. æ£€æŸ¥IMUæ•°æ®
å‘é€å‘½ä»¤: M
æ‰‹åŠ¨æ—‹è½¬æœºå™¨äººï¼Œè§‚å¯Ÿå“ªä¸ªé™€èºä»ªè½´å˜åŒ–

# 2. æ£€æŸ¥IMUåˆå§‹åŒ–
æŸ¥çœ‹ä¸²å£è¾“å‡º: [INFO] MPU6500 initialized successfully

# 3. é‡æ–°æ ¡å‡†
å‘é€å‘½ä»¤: N
```

### é—®é¢˜3ï¼šä½å§¿æ¼‚ç§»ä¸¥é‡

**å¯èƒ½åŸå› **ï¼š
1. å‚æ•°æœªè°ƒä¼˜
2. æ‰“æ»‘ä¸¥é‡
3. IMUæ ¡å‡†ä¸å‡†

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æŒ‰ç…§"å‚æ•°è°ƒä¼˜æŒ‡å—"è°ƒæ•´å‚æ•°
2. å‘é€ `N` å‘½ä»¤é‡æ–°æ ¡å‡†IMU
3. æ£€æŸ¥è½®å­æ˜¯å¦æ‰“æ»‘

### é—®é¢˜4ï¼šPythonç«¯æ”¶ä¸åˆ°POSE

**å¯èƒ½åŸå› **ï¼š
1. ä¸²å£æœªè¿æ¥
2. æ³¢ç‰¹ç‡ä¸åŒ¹é…
3. å›ºä»¶æœªå‘é€

**æ’æŸ¥æ­¥éª¤**ï¼š
```python
# 1. æ£€æŸ¥é€šä¿¡
comm.is_connected()  # åº”è¿”å›True

# 2. æ£€æŸ¥å…¶ä»–æ•°æ®
# å¦‚æœèƒ½æ”¶åˆ°MPU/ODOæ•°æ®ï¼Œè¯´æ˜é€šä¿¡æ­£å¸¸

# 3. ç”¨ä¸²å£åŠ©æ‰‹ç›´æ¥æŸ¥çœ‹
# æ‰“å¼€ä¸²å£åŠ©æ‰‹ï¼Œåº”è¯¥èƒ½çœ‹åˆ°POSEå¼€å¤´çš„è¡Œ
```

---

## ğŸ“ˆ æœªæ¥æ”¹è¿›æ–¹å‘

### çŸ­æœŸæ”¹è¿›ï¼ˆ1-2å‘¨ï¼‰

1. **æ‰“æ»‘æ£€æµ‹**
   - æ¯”è¾ƒIMUåŠ é€Ÿåº¦ä¸é‡Œç¨‹è®¡è®¡ç®—çš„åŠ é€Ÿåº¦
   - æ£€æµ‹åˆ°æ‰“æ»‘æ—¶å¢å¤§è¿‡ç¨‹å™ªå£°

2. **åŠ¨æ€å‚æ•°è°ƒæ•´**
   - æ ¹æ®é€Ÿåº¦åŠ¨æ€è°ƒæ•´å™ªå£°å‚æ•°
   - é«˜é€Ÿæ—¶å¢å¤§å™ªå£°ï¼Œä½é€Ÿæ—¶å‡å°

3. **æ€§èƒ½ä¼˜åŒ–**
   - ä½¿ç”¨æŸ¥æ‰¾è¡¨æ›¿ä»£ä¸‰è§’å‡½æ•°
   - å‡å°‘æµ®ç‚¹è¿ç®—

### ä¸­æœŸæ”¹è¿›ï¼ˆ1ä¸ªæœˆï¼‰

1. **å®Œæ•´EKFå®ç°**
   - å½“å‰åªè€ƒè™‘å¯¹è§’åæ–¹å·®
   - æ”¹è¿›ä¸ºå®Œæ•´3Ã—3åæ–¹å·®çŸ©é˜µ

2. **è§†è§‰è¾…åŠ©å®šä½**
   - é›†æˆArUcoæ ‡è®°ç‰©è¯†åˆ«
   - ä½¿ç”¨è§†è§‰ä½å§¿ä¿®æ­£ç´¯ç§¯è¯¯å·®

3. **é—­ç¯æ£€æµ‹**
   - æœºå™¨äººå›åˆ°ä¹‹å‰ä½ç½®æ—¶è‡ªåŠ¨ä¿®æ­£

### é•¿æœŸæ”¹è¿›ï¼ˆ2-3ä¸ªæœˆï¼‰

1. **å¤šä¼ æ„Ÿå™¨èåˆ**
   - é›†æˆè¶…å£°æ³¢ä¼ æ„Ÿå™¨
   - é›†æˆGPSï¼ˆå®¤å¤–ï¼‰

2. **è‡ªé€‚åº”æ»¤æ³¢**
   - æ ¹æ®ç¯å¢ƒè‡ªåŠ¨è°ƒæ•´å‚æ•°
   - æœºå™¨å­¦ä¹ è¾…åŠ©å‚æ•°ä¼˜åŒ–

---

## âœ… éªŒæ”¶æ£€æŸ¥æ¸…å•

### å›ºä»¶ç«¯

- [ ] `pose_estimator.h` å’Œ `pose_estimator.c` å·²æ·»åŠ åˆ°é¡¹ç›®
- [ ] `main.c` ç¼–è¯‘æ— é”™è¯¯
- [ ] ä¸²å£è¾“å‡ºåŒ…å« `[INFO] Pose estimator initialized`
- [ ] ä¸²å£è¾“å‡ºåŒ…å« `POSE,xxxx,x.xxx,y.xxx,z.xxx` (20Hz)
- [ ] å‘é€ `MODE,1` åPOSEæ•°å€¼å˜åŒ–
- [ ] å‘é€ `RESET,0,0,0` åPOSEé‡ç½®ä¸º0

### Pythonç«¯

- [ ] `RobotComm.on_pose_update` å›è°ƒæ­£å¸¸è§¦å‘
- [ ] `test_pose_estimation.py --test basic` èƒ½æ¥æ”¶æ•°æ®
- [ ] `test_pose_estimation.py --test viz` èƒ½æ˜¾ç¤ºè½¨è¿¹
- [ ] `comm.reset_pose()` èƒ½æˆåŠŸé‡ç½®å›ºä»¶ä½å§¿

### æ€§èƒ½æµ‹è¯•

- [ ] é™æ­¢æ¼‚ç§» < 1cm/30ç§’
- [ ] ç›´çº¿1ç±³è¯¯å·® < 5cm
- [ ] æ—‹è½¬360Â°è¯¯å·® < 10Â°

### é›†æˆæµ‹è¯•

- [ ] æ§åˆ¶å™¨èƒ½ä½¿ç”¨POSEè¿›è¡Œè·¯å¾„è§„åˆ’
- [ ] åœ°å›¾æ›´æ–°èƒ½æ­£ç¡®ä½¿ç”¨POSE
- [ ] DWAé¿éšœèƒ½ä½¿ç”¨POSE

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### è”ç³»æ–¹å¼

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æœ¬æ–‡æ¡£çš„"æ•…éšœæ’æŸ¥"ç« èŠ‚
2. `xxq/docs/ä½å§¿ä¼°è®¡é…ç½®æŒ‡å—.md`
3. ä»£ç æ³¨é‡Š

### è°ƒè¯•å·¥å…·

```bash
# ä¸²å£ç›‘æ§
python -m serial.tools.miniterm COM5 115200

# POSEæ•°æ®è®°å½•
python scripts/test_pose_estimation.py --test basic > pose_log.txt

# å¯è§†åŒ–è°ƒè¯•
python scripts/test_pose_estimation.py --test viz
```

---

## ğŸ‰ æ€»ç»“

### å…³é”®æˆå°±

âœ… **å®Œæ•´å®ç°**ï¼šä»é›¶å®ç°äº†é‡Œç¨‹è®¡+IMUèåˆçš„ä½å§¿ä¼°è®¡ç³»ç»Ÿ  
âœ… **é«˜è´¨é‡ä»£ç **ï¼š380è¡ŒCä»£ç ï¼Œéµå¾ªå·¥ä¸šæ ‡å‡†  
âœ… **å®Œå–„æ–‡æ¡£**ï¼šé…ç½®æŒ‡å—ã€æµ‹è¯•å·¥å…·ã€æ•…éšœæ’æŸ¥  
âœ… **æ— ç¼é›†æˆ**ï¼šä¸ç°æœ‰å¯¼èˆªç³»ç»Ÿå®Œç¾é…åˆ

### æŠ€æœ¯äº®ç‚¹

1. **æ‰©å±•å¡å°”æ›¼æ»¤æ³¢**ï¼šä¸šç•Œæ ‡å‡†çš„ä¼ æ„Ÿå™¨èåˆç®—æ³•
2. **å·®åˆ†é©±åŠ¨è¿åŠ¨å­¦**ï¼šç²¾ç¡®çš„åœ†å¼§è¿åŠ¨æ¨¡å‹
3. **å®æ—¶æ€§èƒ½**ï¼š20Hzæ›´æ–°ï¼Œå»¶è¿Ÿ<1ms
4. **å¯é…ç½®æ€§**ï¼š9ä¸ªå‚æ•°å¯æ ¹æ®åœºæ™¯è°ƒä¼˜

### å¯¹é¡¹ç›®çš„ä»·å€¼

**POSEç³»ç»Ÿæ˜¯è‡ªä¸»å¯¼èˆªçš„åŸºç¡€**ï¼Œä¸ºä»¥ä¸‹åŠŸèƒ½æä¾›æ”¯æ’‘ï¼š
- âœ… SLAMåœ°å›¾æ„å»º
- âœ… è·¯å¾„è§„åˆ’èµ·ç‚¹å®šä½
- âœ… DWAé¿éšœçŠ¶æ€æ›´æ–°
- âœ… Frontieræ¢ç´¢ä½ç½®åˆ¤æ–­
- âœ… é—­ç¯æ£€æµ‹ä¸è½¨è¿¹ä¼˜åŒ–

**æ²¡æœ‰POSEï¼Œè‡ªä¸»å¯¼èˆªç³»ç»Ÿæ— æ³•è¿è¡Œã€‚ç°åœ¨ï¼Œæ‰€æœ‰åŠŸèƒ½éƒ½å·²å°±ç»ªï¼**

---

**æŠ¥å‘Šç¼–åˆ¶**: AIåŠ©æ‰‹  
**å®¡æ ¸çŠ¶æ€**: å¾…ç”¨æˆ·éªŒæ”¶  
**ç‰ˆæœ¬**: v1.0 Final  

