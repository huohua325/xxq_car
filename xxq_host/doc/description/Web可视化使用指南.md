# Web可视化使用指南

## 📖 简介

xxq机器人项目现已支持**Web实时可视化**，提供更现代、直观的SLAM建图展示方式。

### ✨ 特性

- 🌐 **浏览器访问**：无需安装matplotlib，在浏览器中查看实时地图
- 📱 **多设备支持**：支持手机、平板、电脑等多种设备
- 🎨 **美观界面**：现代化Dashboard设计，专业且美观
- ⚡ **实时更新**：通过WebSocket实现低延迟数据推送
- 📊 **丰富信息**：地图、位姿、统计数据、路径等一览无余

---

## 🚀 快速开始

### 1. 安装依赖

首先安装Web可视化所需的依赖包：

```bash
cd xxq_host
pip install Flask>=3.0.0 Flask-SocketIO>=5.3.0 Pillow>=10.0.0
```

或者更新整个依赖：

```bash
pip install -r requirements.txt
```

### 2. 启动Web可视化

运行自主探索程序，添加`--web`参数：

```bash
python main_exploration.py --web
```

### 3. 打开浏览器

程序启动后，在浏览器中访问：

```
http://localhost:5000
```

✅ 就这么简单！您将看到实时的SLAM建图界面。

---

## 🎮 使用方法

### 命令行参数

```bash
# 使用Web可视化（推荐）
python main_exploration.py --web

# 使用传统matplotlib可视化
python main_exploration.py

# 禁用可视化（仅命令行输出）
python main_exploration.py --no-viz

# 自定义Web端口
python main_exploration.py --web --port 8080
```

### 界面说明

打开Web页面后，您将看到：

#### 左侧主面板
- **占据栅格地图**：实时显示SLAM建图结果
  - 白色区域：空闲（可通行）
  - 黑色区域：障碍物（墙壁等）
  - 灰色区域：未知区域
  - 蓝色圆圈：机器人当前位置
  - 红色箭头：机器人朝向
  - 红色点：雷达扫描点云
  - 绿色线：规划路径
  - 黄色点：前沿点

#### 右侧信息栏
- **探索统计**
  - 探索进度条
  - 已占用单元格数量
  - 空闲单元格数量
  - 未知单元格数量

- **机器人位姿**
  - X、Y坐标（米）
  - 朝向角度（度）
  - 线速度（m/s）
  - 角速度（rad/s）

- **图例**
  - 各颜色含义说明

---

## 🔧 高级配置

### 修改端口

如果默认端口5000被占用，可以修改：

```bash
python main_exploration.py --web --port 8080
```

### 局域网访问

Web服务器默认监听`0.0.0.0`，支持局域网内其他设备访问。

1. 查看电脑IP地址（Windows）：
   ```bash
   ipconfig
   ```

2. 在其他设备浏览器中访问：
   ```
   http://192.168.x.x:5000
   ```

### 性能调优

在`config.py`中可调整更新频率：

```python
# 可视化帧率（降低可减少CPU占用）
VISUALIZE_RATE = 10  # FPS，默认10
```

---

## 📊 Web vs Matplotlib 对比

| 特性 | Web可视化 | Matplotlib可视化 |
|-----|----------|-----------------|
| 安装依赖 | Flask + SocketIO | Matplotlib |
| 界面美观 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| 多设备访问 | ✅ | ❌ |
| 远程查看 | ✅ | ❌ |
| 性能 | ⚡ 轻量 | 🐢 较重 |
| 交互性 | ⭐⭐⭐⭐ | ⭐⭐⭐ |
| 适用场景 | 日常使用、演示 | 开发调试 |

---

## ❓ 常见问题

### Q1: 浏览器打不开页面？

**A:** 检查以下几点：
1. 确认程序输出中显示"Web可视化已启动"
2. 检查防火墙是否阻止了端口5000
3. 尝试更换端口：`--port 8080`

### Q2: 地图不更新？

**A:** 
1. 查看浏览器开发者工具（F12）中的控制台错误
2. 确认WebSocket已连接（页面右上角显示"已连接"）
3. 刷新页面重新连接

### Q3: 移动设备无法访问？

**A:**
1. 确保设备与电脑在同一局域网
2. 使用电脑的局域网IP地址，不要用localhost
3. 关闭电脑防火墙测试

### Q4: 性能问题？

**A:**
1. 降低`config.py`中的`VISUALIZE_RATE`
2. 关闭不需要的功能（雷达点云、轨迹等）
3. 使用`--no-viz`模式，仅保存最终地图

---

## 🛠️ 故障排查

### 依赖问题

如果遇到`ModuleNotFoundError`：

```bash
pip install Flask Flask-SocketIO Pillow
```

### 端口占用

Windows查看端口占用：

```bash
netstat -ano | findstr :5000
```

Linux/Mac：

```bash
lsof -i :5000
```

---

## 📚 技术细节

### 架构

```
┌─────────────┐         WebSocket        ┌──────────────┐
│   浏览器    │ ◄─────────────────────► │ Flask服务器  │
│  (前端)     │                          │   (后端)     │
└─────────────┘                          └──────────────┘
                                               │
                                               ▼
                                         ┌──────────────┐
                                         │ Controller   │
                                         │   (控制器)   │
                                         └──────────────┘
```

### 数据流

1. Controller更新地图后调用`visualizer.update()`
2. WebVisualizer将地图转换为PNG图像（base64编码）
3. 通过WebSocket推送数据到浏览器
4. 浏览器接收数据，在Canvas上绘制

### 性能优化

- 地图图像按需生成，避免重复编码
- 雷达点云和前沿点数量限制，减少传输量
- 使用WebSocket而非HTTP轮询，降低延迟

---

## 📞 支持

如有问题，请联系软件组或查看：
- [API文档](./API文档.md)
- [用户手册](./用户手册.md)
- [开发计划](./开发计划.md)

---

**享受更直观的SLAM可视化体验！** 🎉


