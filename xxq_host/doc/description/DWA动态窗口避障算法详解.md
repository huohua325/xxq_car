# DWAåŠ¨æ€çª—å£é¿éšœç®—æ³•è¯¦è§£

**æ–‡ä»¶**: `xxq_host/src/navigation/dwa.py`  
**ç‰ˆæœ¬**: v1.0  
**ä»£ç è¡Œæ•°**: 328è¡Œ  
**ç®—æ³•å¤æ‚åº¦**: â­â­â­â­ (ç»å…¸å±€éƒ¨é¿éšœç®—æ³•)

---

## ğŸ“‹ ç›®å½•

1. [DWAç®—æ³•åŸç†](#dwaç®—æ³•åŸç†)
2. [ä»£ç ç»“æ„æ€»è§ˆ](#ä»£ç ç»“æ„æ€»è§ˆ)
3. [é…ç½®å‚æ•°è¯¦è§£](#é…ç½®å‚æ•°è¯¦è§£)
4. [æ ¸å¿ƒæ–¹æ³•è§£æ](#æ ¸å¿ƒæ–¹æ³•è§£æ)
5. [ç®—æ³•æµç¨‹å›¾](#ç®—æ³•æµç¨‹å›¾)
6. [ä½¿ç”¨ç¤ºä¾‹](#ä½¿ç”¨ç¤ºä¾‹)
7. [å‚æ•°è°ƒä¼˜](#å‚æ•°è°ƒä¼˜)
8. [æ€§èƒ½åˆ†æ](#æ€§èƒ½åˆ†æ)

---

## ğŸ¯ DWAç®—æ³•åŸç†

### ä»€ä¹ˆæ˜¯DWAï¼Ÿ

**DWA (Dynamic Window Approach)** æ˜¯ä¸€ç§ç»å…¸çš„**å±€éƒ¨è·¯å¾„è§„åˆ’å’Œå®æ—¶é¿éšœç®—æ³•**ã€‚

### æ ¸å¿ƒæ€æƒ³

```
å½“å‰ä½ç½® + ç›®æ ‡æ–¹å‘ + éšœç¢ç‰©åˆ†å¸ƒ
         â†“
åœ¨é€Ÿåº¦ç©ºé—´ä¸­æœç´¢å¤šæ¡è½¨è¿¹
         â†“
è¯„ä¼°æ¯æ¡è½¨è¿¹çš„å®‰å…¨æ€§å’Œæ•ˆç‡
         â†“
é€‰æ‹©æœ€ä¼˜è½¨è¿¹
         â†“
è¾“å‡ºé€Ÿåº¦æŒ‡ä»¤ (v, Ï‰)
```

### ä¸‰ä¸ªå…³é”®æ­¥éª¤

#### 1ï¸âƒ£ åŠ¨æ€çª—å£è®¡ç®—

æ ¹æ®æœºå™¨äººçš„**é€Ÿåº¦é™åˆ¶**å’Œ**åŠ é€Ÿåº¦é™åˆ¶**ï¼Œè®¡ç®—å¯è¡Œçš„é€Ÿåº¦èŒƒå›´ï¼š

```
åŠ¨æ€çª—å£ = ç¡¬ä»¶é™åˆ¶ âˆ© åŠ¨åŠ›å­¦é™åˆ¶

ç¡¬ä»¶é™åˆ¶ï¼š
  v âˆˆ [0, v_max]           # æœ€å¤§é€Ÿåº¦
  Ï‰ âˆˆ [-Ï‰_max, Ï‰_max]      # æœ€å¤§è§’é€Ÿåº¦

åŠ¨åŠ›å­¦é™åˆ¶ï¼ˆå½“å‰æ—¶åˆ»èƒ½è¾¾åˆ°çš„é€Ÿåº¦ï¼‰ï¼š
  v âˆˆ [v_current - a_maxÂ·Î”t, v_current + a_maxÂ·Î”t]
  Ï‰ âˆˆ [Ï‰_current - Î±_maxÂ·Î”t, Ï‰_current + Î±_maxÂ·Î”t]
```

#### 2ï¸âƒ£ è½¨è¿¹é¢„æµ‹

å¯¹äºåŠ¨æ€çª—å£å†…çš„æ¯å¯¹ `(v, Ï‰)`ï¼Œä½¿ç”¨**å·®åˆ†é©±åŠ¨è¿åŠ¨å­¦æ¨¡å‹**é¢„æµ‹æœªæ¥è½¨è¿¹ï¼š

```
x_{t+1} = x_t + v Â· cos(Î¸_t) Â· Î”t
y_{t+1} = y_t + v Â· sin(Î¸_t) Â· Î”t
Î¸_{t+1} = Î¸_t + Ï‰ Â· Î”t
```

#### 3ï¸âƒ£ è½¨è¿¹è¯„åˆ†

æ¯æ¡è½¨è¿¹æ ¹æ®ä¸‰ä¸ªæŒ‡æ ‡è¯„åˆ†ï¼š

| æŒ‡æ ‡ | è®¡ç®—å…¬å¼ | å«ä¹‰ |
|------|---------|------|
| **heading** | `Ï€ - |Î¸_end - Î¸_goal|` | æœå‘ç›®æ ‡çš„ç¨‹åº¦ |
| **distance** | `1 / (dist_to_goal + 1)` | æ¥è¿‘ç›®æ ‡çš„ç¨‹åº¦ |
| **velocity** | `v / v_max` | é€Ÿåº¦å¤§å°ï¼ˆé¼“åŠ±å¿«é€Ÿï¼‰ |

**æ€»å¾—åˆ†**ï¼š
```
score = w_heading Ã— heading_score 
      + w_distance Ã— distance_score 
      + w_velocity Ã— velocity_score
```

---

## ğŸ“‚ ä»£ç ç»“æ„æ€»è§ˆ

### æ–‡ä»¶ç»„ç»‡

```python
dwa.py (328è¡Œ)
â”‚
â”œâ”€â”€ DWAConfig (æ•°æ®ç±», 12-39è¡Œ)
â”‚   â””â”€â”€ é…ç½®å‚æ•°å®šä¹‰
â”‚
â””â”€â”€ DWA (ä¸»ç±», 41-328è¡Œ)
    â”‚
    â”œâ”€â”€ __init__()                        # åˆå§‹åŒ–
    â”‚
    â”œâ”€â”€ plan()                            # ä¸»è§„åˆ’æ–¹æ³• â­æ ¸å¿ƒ
    â”‚   â”œâ”€â”€ _calc_dynamic_window()        # è®¡ç®—åŠ¨æ€çª—å£
    â”‚   â”œâ”€â”€ _predict_trajectory()         # é¢„æµ‹è½¨è¿¹
    â”‚   â”œâ”€â”€ _check_collision()            # ç¢°æ’æ£€æµ‹
    â”‚   â””â”€â”€ _evaluate_trajectory()        # è½¨è¿¹è¯„åˆ†
    â”‚
    â”œâ”€â”€ predict_trajectory_to_goal()      # é¢„æµ‹å®Œæ•´è½¨è¿¹
    â”œâ”€â”€ calculate_stopping_time()         # è®¡ç®—åœè½¦æ—¶é—´
    â””â”€â”€ calculate_stopping_distance()     # è®¡ç®—åœè½¦è·ç¦»
```

### æ–¹æ³•ç»Ÿè®¡

| æ–¹æ³•ç±»å‹ | æ•°é‡ | è¯´æ˜ |
|---------|------|------|
| **å…¬å…±æ–¹æ³•** | 4ä¸ª | `plan()`, `predict_trajectory_to_goal()`, åœè½¦è®¡ç®— |
| **ç§æœ‰æ–¹æ³•** | 4ä¸ª | åŠ¨æ€çª—å£ã€è½¨è¿¹é¢„æµ‹ã€ç¢°æ’æ£€æµ‹ã€è¯„åˆ† |
| **æ€»è®¡** | 8ä¸ª | å…¨éƒ¨å®ç° âœ… |

---

## âš™ï¸ é…ç½®å‚æ•°è¯¦è§£

### DWAConfig æ•°æ®ç±» (12-39è¡Œ)

```python
@dataclass
class DWAConfig:
    # ========== é€Ÿåº¦é™åˆ¶ ==========
    max_speed: float = 1.0              # æœ€å¤§çº¿é€Ÿåº¦ m/s
    min_speed: float = 0.0              # æœ€å°çº¿é€Ÿåº¦ m/s
    max_yaw_rate: float = deg2rad(40)   # æœ€å¤§è§’é€Ÿåº¦ rad/s (40Â°/s)
    
    # ========== åŠ é€Ÿåº¦é™åˆ¶ ==========
    max_accel: float = 0.5              # æœ€å¤§çº¿åŠ é€Ÿåº¦ m/sÂ²
    max_yaw_accel: float = deg2rad(80)  # æœ€å¤§è§’åŠ é€Ÿåº¦ rad/sÂ² (80Â°/sÂ²)
    
    # ========== é‡‡æ ·åˆ†è¾¨ç‡ ==========
    v_resolution: float = 0.1           # çº¿é€Ÿåº¦é‡‡æ ·é—´éš” m/s
    yaw_rate_resolution: float = deg2rad(5)  # è§’é€Ÿåº¦é‡‡æ ·é—´éš” (5Â°/s)
    
    # ========== é¢„æµ‹å‚æ•° ==========
    predict_time: float = 2.0           # é¢„æµ‹æ—¶é—´é•¿åº¦ s
    dt: float = 0.1                     # é¢„æµ‹æ—¶é—´æ­¥é•¿ s
    
    # ========== è¯„åˆ†æƒé‡ ==========
    heading_weight: float = 0.5         # æœå‘å¾—åˆ†æƒé‡
    distance_weight: float = 0.3        # è·ç¦»å¾—åˆ†æƒé‡
    velocity_weight: float = 0.2        # é€Ÿåº¦å¾—åˆ†æƒé‡
    
    # ========== å®‰å…¨å‚æ•° ==========
    robot_radius: float = 0.2           # æœºå™¨äººåŠå¾„ m
    safety_margin: float = 0.1          # å®‰å…¨è£•åº¦ m
```

### å‚æ•°æ¥æº

**ç°åœ¨ä» `config.py` è¯»å–**ï¼š

```python
# config.py ç¬¬58-72è¡Œ
DWA_MAX_SPEED = 1.0
DWA_MAX_YAW_RATE = 40.0
DWA_PREDICT_TIME = 2.0
DWA_WEIGHT_HEADING = 0.15
DWA_WEIGHT_CLEARANCE = 0.1
DWA_WEIGHT_VELOCITY = 0.2
# ...

# controller.py ç¬¬96-100è¡Œ
dwa_config = DWAConfig(
    max_speed=config.DWA_MAX_SPEED,
    max_yaw_rate=np.deg2rad(config.DWA_MAX_YAW_RATE),
    predict_time=config.DWA_PREDICT_TIME
)
```

---

## ğŸ” æ ¸å¿ƒæ–¹æ³•è§£æ

### 1ï¸âƒ£ plan() - ä¸»è§„åˆ’æ–¹æ³• (71-120è¡Œ)

#### åŠŸèƒ½
**DWAçš„æ ¸å¿ƒæ–¹æ³•**ï¼Œæ¥æ”¶å½“å‰çŠ¶æ€å’Œç›®æ ‡ï¼Œè¾“å‡ºæœ€ä¼˜é€Ÿåº¦æŒ‡ä»¤ã€‚

#### è¾“å…¥è¾“å‡º

```python
def plan(
    robot_state: (x, y, Î¸, v, Ï‰),  # æœºå™¨äººçŠ¶æ€
    goal: (x_goal, y_goal),         # ç›®æ ‡ä½ç½®
    obstacles: [(x1,y1), (x2,y2)]   # éšœç¢ç‰©åˆ—è¡¨ï¼ˆå¯é€‰ï¼‰
) -> (v_best, Ï‰_best)               # æœ€ä¼˜é€Ÿåº¦æŒ‡ä»¤
```

#### è¯¦ç»†æµç¨‹

```python
# ========== æ­¥éª¤1: è®¡ç®—åŠ¨æ€çª—å£ ==========
v_range, omega_range = self._calc_dynamic_window(v, omega)
# è¾“å‡ºç¤ºä¾‹ï¼š
# v_range = (0.5, 1.0)        # å¯è¡Œçº¿é€Ÿåº¦èŒƒå›´
# omega_range = (-0.7, 0.7)   # å¯è¡Œè§’é€Ÿåº¦èŒƒå›´

# ========== æ­¥éª¤2: ç”Ÿæˆé€Ÿåº¦å€™é€‰ ==========
v_samples = np.arange(v_range[0], v_range[1], v_resolution)
omega_samples = np.arange(omega_range[0], omega_range[1], yaw_rate_resolution)

# ç¤ºä¾‹ï¼š
# v_samples = [0.5, 0.6, 0.7, 0.8, 0.9, 1.0]         # 6ä¸ªå€™é€‰
# omega_samples = [-0.7, -0.52, ..., 0.52, 0.7]      # 17ä¸ªå€™é€‰
# æ€»å…±ï¼š6 Ã— 17 = 102 æ¡è½¨è¿¹éœ€è¦è¯„ä¼°

# ========== æ­¥éª¤3: éå†è¯„ä¼° ==========
best_v = 0.0
best_omega = 0.0
max_score = -inf

for v_test in v_samples:
    for omega_test in omega_samples:
        # 3.1 é¢„æµ‹è½¨è¿¹
        trajectory = self._predict_trajectory(x, y, Î¸, v_test, omega_test)
        
        # 3.2 ç¢°æ’æ£€æµ‹
        if obstacles and self._check_collision(trajectory, obstacles):
            continue  # è·³è¿‡ç¢°æ’è½¨è¿¹
        
        # 3.3 è¯„åˆ†
        score = self._evaluate_trajectory(trajectory, goal, v_test)
        
        # 3.4 æ›´æ–°æœ€ä¼˜
        if score > max_score:
            max_score = score
            best_v = v_test
            best_omega = omega_test

# ========== æ­¥éª¤4: è¿”å›æœ€ä¼˜é€Ÿåº¦ ==========
return best_v, best_omega
```

#### æ—¶é—´å¤æ‚åº¦

```
å€™é€‰æ•°é‡ = (v_samples Ã— Ï‰_samples)
         = (v_range / v_resolution) Ã— (Ï‰_range / Ï‰_resolution)
         = (1.0 / 0.1) Ã— (1.4 / 0.087)  # é»˜è®¤å‚æ•°
         â‰ˆ 10 Ã— 16 = 160 æ¡è½¨è¿¹

æ¯æ¡è½¨è¿¹ï¼š
  - é¢„æµ‹ï¼šO(predict_time / dt) = O(2.0 / 0.1) = O(20)
  - ç¢°æ’æ£€æµ‹ï¼šO(20 Ã— N_obstacles)
  - è¯„åˆ†ï¼šO(1)

æ€»å¤æ‚åº¦ï¼šO(160 Ã— 20 Ã— N_obstacles) = O(3200 Ã— N_obstacles)
```

**ä¼˜åŒ–ç©ºé—´**ï¼š
- ä½¿ç”¨ç²—ç²’åº¦é‡‡æ · + ç»†åŒ–æœç´¢
- å¹¶è¡Œè¯„ä¼°å¤šæ¡è½¨è¿¹
- æ—©åœï¼ˆæå‰å‰ªæå·®è½¨è¿¹ï¼‰

---

### 2ï¸âƒ£ _calc_dynamic_window() - è®¡ç®—åŠ¨æ€çª—å£ (122-156è¡Œ)

#### åŠŸèƒ½
æ ¹æ®å½“å‰é€Ÿåº¦å’ŒåŠ é€Ÿåº¦é™åˆ¶ï¼Œè®¡ç®—å¯è¡Œçš„é€Ÿåº¦èŒƒå›´ã€‚

#### ç®—æ³•å›¾è§£

```
ç¡¬ä»¶é™åˆ¶çª—å£ï¼š
  v: |===============================| [0, 1.0]
  Ï‰: |===============================| [-0.7, 0.7]

åŠ¨åŠ›å­¦é™åˆ¶çª—å£ï¼ˆå‡è®¾å½“å‰ v=0.6, Ï‰=0.2ï¼‰ï¼š
  v: |----------|==================|----| [0.55, 0.65]  (Â±0.05 = aÂ·dt)
  Ï‰: |----------|=======|------------|---| [0.12, 0.28] (Â±0.08 = Î±Â·dt)

åŠ¨æ€çª—å£ï¼ˆå–äº¤é›†ï¼‰ï¼š
  v: |----------|======|=============|---| [0.55, 0.65]
  Ï‰: |----------|===|----------------|---| [0.12, 0.28]
```

#### ä»£ç å®ç°

```python
def _calc_dynamic_window(current_v, current_omega):
    # ç¡¬ä»¶é™åˆ¶
    v_min = 0.0
    v_max = max_speed                    # 1.0 m/s
    omega_min = -max_yaw_rate            # -0.7 rad/s
    omega_max = max_yaw_rate             # 0.7 rad/s
    
    # åŠ¨åŠ›å­¦é™åˆ¶
    v_min_dyn = current_v - max_accel * dt     # å½“å‰é€Ÿåº¦ - å‡é€Ÿèƒ½åŠ›
    v_max_dyn = current_v + max_accel * dt     # å½“å‰é€Ÿåº¦ + åŠ é€Ÿèƒ½åŠ›
    omega_min_dyn = current_omega - max_yaw_accel * dt
    omega_max_dyn = current_omega + max_yaw_accel * dt
    
    # å–äº¤é›†
    v_min = max(v_min, v_min_dyn)
    v_max = min(v_max, v_max_dyn)
    omega_min = max(omega_min, omega_min_dyn)
    omega_max = min(omega_max, omega_max_dyn)
    
    return (v_min, v_max), (omega_min, omega_max)
```

#### ç‰©ç†æ„ä¹‰

**ä¸ºä»€ä¹ˆéœ€è¦åŠ¨æ€çª—å£ï¼Ÿ**

1. **å¹³æ»‘æ§åˆ¶**ï¼šé¿å…é€Ÿåº¦çªå˜ï¼ˆä»0çªç„¶åˆ°1.0ï¼‰
2. **ç‰©ç†å¯è¾¾**ï¼šè€ƒè™‘ç”µæœºåŠ é€Ÿåº¦é™åˆ¶
3. **ç´§æ€¥åˆ¶åŠ¨**ï¼šéœ€è¦æ—¶èƒ½å¿«é€Ÿåœä¸‹

**ç¤ºä¾‹**ï¼š
```
å½“å‰é€Ÿåº¦ v=0.8 m/sï¼Œdt=0.1sï¼Œmax_accel=0.5 m/sÂ²

ä¸‹ä¸€æ—¶åˆ»å¯è¾¾é€Ÿåº¦èŒƒå›´ï¼š
  æœ€å°ï¼š0.8 - 0.5Ã—0.1 = 0.75 m/s  ï¼ˆå‡é€Ÿï¼‰
  æœ€å¤§ï¼š0.8 + 0.5Ã—0.1 = 0.85 m/s  ï¼ˆåŠ é€Ÿï¼‰

ä¸èƒ½ç›´æ¥è·³åˆ° v=1.0 æˆ– v=0ï¼
```

---

### 3ï¸âƒ£ _predict_trajectory() - è½¨è¿¹é¢„æµ‹ (158-192è¡Œ)

#### åŠŸèƒ½
ä½¿ç”¨å·®åˆ†é©±åŠ¨è¿åŠ¨å­¦æ¨¡å‹ï¼Œé¢„æµ‹ç»™å®šé€Ÿåº¦ä¸‹çš„æœªæ¥è½¨è¿¹ã€‚

#### è¿åŠ¨å­¦æ¨¡å‹

```
å·®åˆ†é©±åŠ¨æœºå™¨äººçš„è¿åŠ¨å­¦æ–¹ç¨‹ï¼š

x(t+Î”t) = x(t) + vÂ·cos(Î¸)Â·Î”t
y(t+Î”t) = y(t) + vÂ·sin(Î¸)Â·Î”t
Î¸(t+Î”t) = Î¸(t) + Ï‰Â·Î”t
```

#### ä»£ç å®ç°

```python
def _predict_trajectory(x, y, theta, v, omega):
    trajectory = []
    time = 0.0
    
    # ä» t=0 é¢„æµ‹åˆ° t=predict_time (é»˜è®¤2ç§’)
    while time <= predict_time:
        # æ¬§æ‹‰ç§¯åˆ†æ³•æ›´æ–°çŠ¶æ€
        x += v * cos(theta) * dt
        y += v * sin(theta) * dt
        theta += omega * dt
        
        # è§’åº¦å½’ä¸€åŒ–åˆ° [-Ï€, Ï€]
        theta = arctan2(sin(theta), cos(theta))
        
        trajectory.append((x, y, theta))
        time += dt
    
    return trajectory
```

#### é¢„æµ‹ç»“æœç¤ºä¾‹

```python
# è¾“å…¥
x=0, y=0, theta=0, v=1.0, omega=0.5, dt=0.1, predict_time=2.0

# è¾“å‡ºï¼ˆ20ä¸ªç‚¹ï¼‰
[
  (0.10, 0.00, 0.05),  # t=0.1s
  (0.20, 0.01, 0.10),  # t=0.2s
  (0.29, 0.02, 0.15),  # t=0.3s
  ...
  (1.68, 0.84, 1.00)   # t=2.0s
]
```

#### è½¨è¿¹å½¢çŠ¶

| æƒ…å†µ | v | Ï‰ | è½¨è¿¹å½¢çŠ¶ |
|------|---|---|---------|
| ç›´çº¿å‰è¿› | 1.0 | 0.0 | `â”â”â”â”â”â”â†’` |
| å³è½¬ | 1.0 | -0.5 | `â•­â”â”â”â”â”â•®` |
| å·¦è½¬ | 1.0 | 0.5 | `â•°â”â”â”â”â”â•¯` |
| åŸåœ°æ—‹è½¬ | 0.0 | 1.0 | `âŸ²` |

---

### 4ï¸âƒ£ _check_collision() - ç¢°æ’æ£€æµ‹ (194-214è¡Œ)

#### åŠŸèƒ½
æ£€æŸ¥é¢„æµ‹è½¨è¿¹æ˜¯å¦ä¸éšœç¢ç‰©ç¢°æ’ã€‚

#### ç®—æ³•

```python
def _check_collision(trajectory, obstacles):
    safe_distance = robot_radius + safety_margin  # 0.2 + 0.1 = 0.3m
    
    # æ£€æŸ¥è½¨è¿¹ä¸Šçš„æ¯ä¸ªç‚¹
    for (x, y, Î¸) in trajectory:
        # ä¸æ¯ä¸ªéšœç¢ç‰©æ¯”è¾ƒ
        for (obs_x, obs_y) in obstacles:
            dist = sqrt((x - obs_x)Â² + (y - obs_y)Â²)
            
            if dist < safe_distance:
                return True  # ç¢°æ’ï¼
    
    return False  # å®‰å…¨
```

#### å›¾è§£

```
æœºå™¨äººåŠå¾„ = 0.2m
å®‰å…¨è£•åº¦   = 0.1m
å®‰å…¨è·ç¦»   = 0.3m

    éšœç¢ç‰©
      â—
     â•± â•²
    â•±0.3mâ•²    â† å®‰å…¨è·ç¦»
   â•±       â•²
  â•±â”€â”€â”€â”€â”€â”€â”€â”€â”€â•²
  â”‚  æœºå™¨äºº  â”‚
  â”‚    âŠ•    â”‚ 0.2måŠå¾„
  â•²â”€â”€â”€â”€â”€â”€â”€â”€â”€â•±
   â•²   0.1mâ•±     â† å®‰å…¨è£•åº¦
    â•²     â•±
     â•²   â•±
      â•² â•±

å¦‚æœè½¨è¿¹è¿›å…¥0.3mèŒƒå›´ â†’ åˆ¤å®šä¸ºç¢°æ’
```

#### å¤æ‚åº¦

```
O(N_trajectory Ã— N_obstacles)
= O(20 Ã— N_obstacles)
```

**ä¼˜åŒ–æ–¹æ³•**ï¼š
- ä½¿ç”¨KDæ ‘åŠ é€Ÿæœ€è¿‘é‚»æœç´¢
- åªæ£€æŸ¥è½¨è¿¹çš„å…³é”®ç‚¹ï¼ˆæ¯éš”å‡ ä¸ªç‚¹ï¼‰

---

### 5ï¸âƒ£ _evaluate_trajectory() - è½¨è¿¹è¯„åˆ† (216-259è¡Œ)

#### åŠŸèƒ½
ç»¼åˆè¯„ä¼°è½¨è¿¹çš„è´¨é‡ï¼Œåˆ†æ•°è¶Šé«˜è¶Šå¥½ã€‚

#### ä¸‰ç»´è¯„åˆ†ç³»ç»Ÿ

```python
# ========== 1. æœå‘å¾—åˆ† (heading) ==========
# è½¨è¿¹ç»ˆç‚¹çš„æœå‘ä¸ç›®æ ‡æ–¹å‘çš„åå·®

goal_angle = arctan2(goal_y - end_y, goal_x - end_x)  # ç›®æ ‡æ–¹å‘
angle_diff = |end_theta - goal_angle|                 # è§’åº¦å·®
heading_score = Ï€ - angle_diff                        # å·®è¶Šå°ï¼Œåˆ†è¶Šé«˜

# èŒƒå›´ï¼š[0, Ï€]
# æœ€ä¼˜ï¼šÏ€ (å®Œå…¨å¯¹å‡†ç›®æ ‡)
# æœ€å·®ï¼š0 (èƒŒå‘ç›®æ ‡)


# ========== 2. è·ç¦»å¾—åˆ† (distance) ==========
# è½¨è¿¹ç»ˆç‚¹è·ç¦»ç›®æ ‡çš„è¿œè¿‘

dist_to_goal = sqrt((end_x - goal_x)Â² + (end_y - goal_y)Â²)
distance_score = 1.0 / (dist_to_goal + 1.0)

# èŒƒå›´ï¼š(0, 1]
# æœ€ä¼˜ï¼š1.0 (åˆ°è¾¾ç›®æ ‡ dist=0)
# æ¸å¼±ï¼š0.5 (è·ç¦»1ç±³), 0.33 (è·ç¦»2ç±³)


# ========== 3. é€Ÿåº¦å¾—åˆ† (velocity) ==========
# é¼“åŠ±æ›´å¿«çš„é€Ÿåº¦ï¼ˆå‰ææ˜¯å®‰å…¨ï¼‰

velocity_score = v / max_speed

# èŒƒå›´ï¼š[0, 1]
# æœ€ä¼˜ï¼š1.0 (å…¨é€Ÿå‰è¿›)
# æœ€å·®ï¼š0.0 (é™æ­¢)


# ========== ç»¼åˆå¾—åˆ† ==========
total_score = w_heading Ã— heading_score
            + w_distance Ã— distance_score
            + w_velocity Ã— velocity_score

# é»˜è®¤æƒé‡ï¼š
# w_heading = 0.5   (æœ€é‡è¦ï¼šæœå‘æ­£ç¡®)
# w_distance = 0.3  (æ¬¡é‡è¦ï¼šæ¥è¿‘ç›®æ ‡)
# w_velocity = 0.2  (è¾ƒè½»ï¼šä¿æŒé€Ÿåº¦)
```

#### è¯„åˆ†ç¤ºä¾‹

**åœºæ™¯1ï¼šç†æƒ³è½¨è¿¹**
```
æœºå™¨äººä½ç½®ï¼š(0, 0, 0Â°)
ç›®æ ‡ä½ç½®ï¼š(5, 0)
è½¨è¿¹ç»ˆç‚¹ï¼š(2, 0, 0Â°)ï¼Œé€Ÿåº¦ v=1.0

heading_score  = Ï€ - 0 = 3.14           (å®Œå…¨å¯¹å‡†)
distance_score = 1/(3+1) = 0.25         (è¿˜æœ‰3ç±³)
velocity_score = 1.0/1.0 = 1.0          (å…¨é€Ÿ)

total = 0.5Ã—3.14 + 0.3Ã—0.25 + 0.2Ã—1.0
      = 1.57 + 0.075 + 0.2
      = 1.845 â­â­â­â­â­
```

**åœºæ™¯2ï¼šè½¬å¼¯è½¨è¿¹**
```
æœºå™¨äººä½ç½®ï¼š(0, 0, 0Â°)
ç›®æ ‡ä½ç½®ï¼š(3, 3)  (45Â°æ–¹å‘)
è½¨è¿¹ç»ˆç‚¹ï¼š(1.5, 1.2, 30Â°)ï¼Œé€Ÿåº¦ v=0.8

heading_score  = Ï€ - 0.26 = 2.88        (åå·®15Â°)
distance_score = 1/(2.3+1) = 0.30       (è¿˜æœ‰2.3ç±³)
velocity_score = 0.8/1.0 = 0.8          (80%é€Ÿåº¦)

total = 0.5Ã—2.88 + 0.3Ã—0.30 + 0.2Ã—0.8
      = 1.44 + 0.09 + 0.16
      = 1.69 â­â­â­â­
```

**åœºæ™¯3ï¼šèƒŒå‘ç›®æ ‡**
```
æœºå™¨äººä½ç½®ï¼š(0, 0, 0Â°)
ç›®æ ‡ä½ç½®ï¼š(5, 0)
è½¨è¿¹ç»ˆç‚¹ï¼š(-0.5, 0, 180Â°)ï¼Œé€Ÿåº¦ v=0.5

heading_score  = Ï€ - Ï€ = 0              (èƒŒå‘ï¼)
distance_score = 1/(5.5+1) = 0.15       (æ›´è¿œäº†)
velocity_score = 0.5/1.0 = 0.5          (æ…¢é€Ÿ)

total = 0.5Ã—0 + 0.3Ã—0.15 + 0.2Ã—0.5
      = 0 + 0.045 + 0.1
      = 0.145 â­ (æå·®)
```

---

### 6ï¸âƒ£ predict_trajectory_to_goal() - é¢„æµ‹å®Œæ•´è½¨è¿¹ (261-297è¡Œ)

#### åŠŸèƒ½
è¿­ä»£ä½¿ç”¨DWAï¼Œé¢„æµ‹ä»å½“å‰ä½ç½®åˆ°ç›®æ ‡çš„å®Œæ•´è½¨è¿¹ã€‚

#### ç”¨é€”
- **å¯è§†åŒ–**ï¼šæ˜¾ç¤ºé¢„æœŸè·¯å¾„
- **éªŒè¯**ï¼šæ£€æŸ¥èƒ½å¦åˆ°è¾¾ç›®æ ‡
- **è°ƒè¯•**ï¼šåˆ†æç®—æ³•è¡Œä¸º

#### ä»£ç é€»è¾‘

```python
def predict_trajectory_to_goal(robot_state, goal, max_steps=100):
    trajectory = []
    x, y, theta, v, omega = robot_state
    
    for step in range(max_steps):
        trajectory.append((x, y))
        
        # æ£€æŸ¥æ˜¯å¦åˆ°è¾¾
        dist = hypot(x - goal[0], y - goal[1])
        if dist < 0.2:
            break  # åˆ°è¾¾ç›®æ ‡ï¼
        
        # ä½¿ç”¨DWAè§„åˆ’ä¸‹ä¸€æ­¥
        current_state = (x, y, theta, v, omega)
        v, omega = self.plan(current_state, goal)
        
        # æ›´æ–°çŠ¶æ€
        x += v * cos(theta) * dt
        y += v * sin(theta) * dt
        theta += omega * dt
        theta = normalize_angle(theta)
    
    trajectory.append(goal)  # ç»ˆç‚¹
    return trajectory
```

#### å¤æ‚åº¦

```
O(max_steps Ã— complexity_of_plan)
= O(100 Ã— 3200 Ã— N_obstacles)
= O(320000 Ã— N_obstacles)

è®¡ç®—è¾ƒæ…¢ï¼Œä»…ç”¨äºç¦»çº¿åˆ†æï¼Œä¸å»ºè®®åœ¨çº¿ä½¿ç”¨
```

---

### 7ï¸âƒ£ calculate_stopping_time() - åœè½¦æ—¶é—´ (299-311è¡Œ)

#### å…¬å¼

```
t_stop = v_current / a_max

ç¤ºä¾‹ï¼š
  v_current = 1.0 m/s
  a_max = 0.5 m/sÂ²
  
  t_stop = 1.0 / 0.5 = 2.0 ç§’
```

#### ä»£ç 

```python
def calculate_stopping_time(current_v):
    if current_v <= 0:
        return 0.0
    
    return current_v / max_accel
```

---

### 8ï¸âƒ£ calculate_stopping_distance() - åœè½¦è·ç¦» (313-327è¡Œ)

#### å…¬å¼

```
s_stop = vÂ² / (2a)

æ¨å¯¼ï¼š
  v_fÂ² = v_0Â² + 2as  (åŒ€å‡é€Ÿè¿åŠ¨)
  0 = vÂ² - 2as       (æœ€ç»ˆé€Ÿåº¦ä¸º0)
  s = vÂ² / (2a)

ç¤ºä¾‹ï¼š
  v_current = 1.0 m/s
  a_max = 0.5 m/sÂ²
  
  s_stop = 1.0Â² / (2 Ã— 0.5) = 1.0 ç±³
```

#### ä»£ç 

```python
def calculate_stopping_distance(current_v):
    if current_v <= 0:
        return 0.0
    
    return current_v * current_v / (2 * max_accel)
```

---

## ğŸ”„ ç®—æ³•æµç¨‹å›¾

### ä¸»æµç¨‹ plan()

```
å¼€å§‹ plan(robot_state, goal, obstacles)
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. è®¡ç®—åŠ¨æ€çª—å£                 â”‚
â”‚    _calc_dynamic_window()      â”‚
â”‚    â†’ v_range, Ï‰_range          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ç”Ÿæˆé€Ÿåº¦å€™é€‰                 â”‚
â”‚    v_samples = [v_min...v_max] â”‚
â”‚    Ï‰_samples = [Ï‰_min...Ï‰_max] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. éå†æ‰€æœ‰ (v, Ï‰) ç»„åˆ         â”‚
â”‚    for v in v_samples:         â”‚
â”‚      for Ï‰ in Ï‰_samples:       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 3.1 é¢„æµ‹è½¨è¿¹       â”‚
    â”‚ _predict_trajectoryâ”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 3.2 ç¢°æ’æ£€æµ‹ï¼Ÿ     â”‚
    â”‚ _check_collision  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â•± â•²
         ç¢°æ’  å®‰å…¨
          â†“    â†“
       è·³è¿‡   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ 3.3 è½¨è¿¹è¯„åˆ†  â”‚
              â”‚_evaluate_     â”‚
              â”‚trajectory     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ 3.4 æ›´æ–°æœ€ä¼˜  â”‚
              â”‚ if score >    â”‚
              â”‚   max_score   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
            æ‰€æœ‰ç»„åˆè¯„ä¼°å®Œæˆï¼Ÿ
           â•±                 â•²
         å¦                   æ˜¯
         â†“                    â†“
      ç»§ç»­éå†        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚ 4. è¿”å›æœ€ä¼˜   â”‚
                      â”‚ (v*, Ï‰*)     â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
                          ç»“æŸ
```

### è½¨è¿¹é¢„æµ‹æµç¨‹

```
_predict_trajectory(x, y, Î¸, v, Ï‰)
         â†“
  åˆå§‹åŒ– trajectory = []
  time = 0
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ å¾ªç¯å¼€å§‹  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â†“
    time â‰¤ predict_time ?
       â•±         â•²
     å¦           æ˜¯
     â†“            â†“
  è¿”å›è½¨è¿¹   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ è¿åŠ¨å­¦æ›´æ–°       â”‚
            â”‚ x += vÂ·cos(Î¸)Â·dt â”‚
            â”‚ y += vÂ·sin(Î¸)Â·dt â”‚
            â”‚ Î¸ += Ï‰Â·dt        â”‚
            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ è®°å½•è½¨è¿¹ç‚¹      â”‚
            â”‚ append((x,y,Î¸)) â”‚
            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
            time += dt
                 â†“
            å›åˆ°å¾ªç¯å¼€å§‹
```

---

## ğŸ’» ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ç”¨æ³•

```python
from xxq_host.src.navigation.dwa import DWA, DWAConfig

# 1. åˆ›å»ºDWAå¯¹è±¡ï¼ˆä½¿ç”¨é»˜è®¤é…ç½®ï¼‰
dwa = DWA()

# 2. å®šä¹‰æœºå™¨äººçŠ¶æ€
robot_state = (
    0.0,   # x ä½ç½®
    0.0,   # y ä½ç½®
    0.0,   # theta èˆªå‘è§’
    0.5,   # v å½“å‰çº¿é€Ÿåº¦
    0.0    # omega å½“å‰è§’é€Ÿåº¦
)

# 3. å®šä¹‰ç›®æ ‡ç‚¹
goal = (5.0, 3.0)  # å‰æ–¹5ç±³ï¼Œå·¦ä¾§3ç±³

# 4. å®šä¹‰éšœç¢ç‰©ï¼ˆå¯é€‰ï¼‰
obstacles = [
    (2.0, 1.0),  # éšœç¢ç‰©1
    (3.0, 2.0),  # éšœç¢ç‰©2
]

# 5. è§„åˆ’
v_cmd, omega_cmd = dwa.plan(robot_state, goal, obstacles)

print(f"é€Ÿåº¦æŒ‡ä»¤: v={v_cmd:.2f} m/s, Ï‰={omega_cmd:.2f} rad/s")
# è¾“å‡º: é€Ÿåº¦æŒ‡ä»¤: v=0.9 m/s, Ï‰=0.35 rad/s
```

### ä¸config.pyé›†æˆ

```python
import config
from xxq_host.src.navigation.dwa import DWA, DWAConfig
import numpy as np

# ä»é…ç½®æ–‡ä»¶åˆ›å»ºDWA
dwa_config = DWAConfig(
    max_speed=config.DWA_MAX_SPEED,
    max_yaw_rate=np.deg2rad(config.DWA_MAX_YAW_RATE),
    predict_time=config.DWA_PREDICT_TIME,
    heading_weight=config.DWA_WEIGHT_HEADING,
    distance_weight=config.DWA_WEIGHT_CLEARANCE,
    velocity_weight=config.DWA_WEIGHT_VELOCITY
)

dwa = DWA(dwa_config)
```

### åœ¨æ§åˆ¶å¾ªç¯ä¸­ä½¿ç”¨

```python
# æ§åˆ¶å¾ªç¯
while not reached_goal:
    # 1. è·å–å½“å‰çŠ¶æ€ï¼ˆä»ä¼ æ„Ÿå™¨ï¼‰
    robot_state = get_robot_state()  # (x, y, Î¸, v, Ï‰)
    
    # 2. æå–éšœç¢ç‰©ï¼ˆä»é›·è¾¾æ•°æ®ï¼‰
    obstacles = extract_obstacles_from_lidar()
    
    # 3. DWAè§„åˆ’
    v_cmd, omega_cmd = dwa.plan(robot_state, goal, obstacles)
    
    # 4. å‘é€é€Ÿåº¦æŒ‡ä»¤
    send_velocity_command(v_cmd, omega_cmd)
    
    # 5. ç­‰å¾…ä¸‹ä¸€ä¸ªæ§åˆ¶å‘¨æœŸ
    time.sleep(0.1)  # 10Hzæ§åˆ¶é¢‘ç‡
```

### å¯è§†åŒ–è½¨è¿¹

```python
import matplotlib.pyplot as plt

# é¢„æµ‹å®Œæ•´è½¨è¿¹
robot_state = (0, 0, 0, 0, 0)
goal = (10, 5)

trajectory = dwa.predict_trajectory_to_goal(robot_state, goal, max_steps=100)

# ç»˜åˆ¶
x_vals, y_vals = zip(*trajectory)
plt.plot(x_vals, y_vals, 'b-', label='DWAè½¨è¿¹')
plt.plot(goal[0], goal[1], 'r*', markersize=15, label='ç›®æ ‡')
plt.legend()
plt.axis('equal')
plt.grid(True)
plt.show()
```

---

## ğŸ›ï¸ å‚æ•°è°ƒä¼˜

### é€Ÿåº¦å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è°ƒä¼˜å»ºè®® |
|------|--------|---------|
| `max_speed` | 1.0 m/s | **ä¿å®ˆ**ï¼š0.5-0.8ï¼ˆå®¤å†…ï¼‰<br>**æ¿€è¿›**ï¼š1.5-2.0ï¼ˆå®¤å¤–ï¼‰ |
| `max_yaw_rate` | 40Â°/s | **çµæ´»è½¬å‘**ï¼š60-80Â°/s<br>**å¹³ç¨³è¿åŠ¨**ï¼š20-30Â°/s |
| `max_accel` | 0.5 m/sÂ² | æ ¹æ®ç”µæœºæ€§èƒ½è°ƒæ•´<br>å¤ªå°â†’å“åº”æ…¢ï¼Œå¤ªå¤§â†’ä¸å¹³æ»‘ |

**ä¿®æ”¹æ–¹æ³•**ï¼šç¼–è¾‘ `config.py` ç¬¬58-60è¡Œ

```python
DWA_MAX_SPEED = 0.8      # é™ä½é€Ÿåº¦æ›´å®‰å…¨
DWA_MAX_YAW_RATE = 50.0  # æé«˜è½¬å‘çµæ´»æ€§
DWA_MAX_ACCEL = 0.6      # æé«˜å“åº”é€Ÿåº¦
```

### é‡‡æ ·åˆ†è¾¨ç‡

| å‚æ•° | é»˜è®¤å€¼ | å½±å“ |
|------|--------|------|
| `v_resolution` | 0.1 m/s | **æ›´å°**ï¼šæ›´ç²¾ç»†ï¼Œæ›´æ…¢<br>**æ›´å¤§**ï¼šæ›´å¿«ï¼Œæ›´ç²—ç³™ |
| `yaw_rate_resolution` | 5Â°/s | åŒä¸Š |

**æƒè¡¡**ï¼š
```
ç²¾ç»†é‡‡æ · (v_res=0.05, Ï‰_res=2.5Â°)
  ä¼˜ç‚¹ï¼šæ‰¾åˆ°æ›´ä¼˜è§£
  ç¼ºç‚¹ï¼šè®¡ç®—é‡ Ã—4ï¼Œè€—æ—¶å¢åŠ 

ç²—ç³™é‡‡æ · (v_res=0.2, Ï‰_res=10Â°)
  ä¼˜ç‚¹ï¼šè®¡ç®—å¿«ï¼Œé€‚åˆå®æ—¶
  ç¼ºç‚¹ï¼šå¯èƒ½é”™è¿‡æœ€ä¼˜è§£
```

**å»ºè®®**ï¼š
- ä»¿çœŸ/æµ‹è¯•ï¼šç²¾ç»†é‡‡æ ·
- å®é™…è¿è¡Œï¼šç²—ç³™é‡‡æ ·ï¼ˆä¿è¯å®æ—¶æ€§ï¼‰

### è¯„åˆ†æƒé‡

| æƒé‡ | é»˜è®¤å€¼ | æ•ˆæœ |
|------|--------|------|
| `heading_weight` | 0.5 | **å¢å¤§**ï¼šæ›´ç›´æ¥æœå‘ç›®æ ‡<br>**å‡å°**ï¼šè·¯å¾„æ›´æ›²æŠ˜ |
| `distance_weight` | 0.3 | **å¢å¤§**ï¼šæ›´å¿«æ¥è¿‘ç›®æ ‡<br>**å‡å°**ï¼šæ›´æ³¨é‡æ–¹å‘ |
| `velocity_weight` | 0.2 | **å¢å¤§**ï¼šæ›´å€¾å‘é«˜é€Ÿ<br>**å‡å°**ï¼šæ›´æ³¨é‡ç²¾ç¡® |

**åœºæ™¯è°ƒä¼˜**ï¼š

**åœºæ™¯1ï¼šç‹­çª„é€šé“**
```python
heading_weight = 0.6    # æé«˜ï¼Œå¿…é¡»å¯¹å‡†
distance_weight = 0.2   # é™ä½ï¼Œä¸æ±‚å¿«
velocity_weight = 0.2   # é€‚ä¸­
```

**åœºæ™¯2ï¼šç©ºæ—·åŒºåŸŸ**
```python
heading_weight = 0.3    # é™ä½ï¼Œè·¯å¾„çµæ´»
distance_weight = 0.4   # æé«˜ï¼Œå¿«é€Ÿæ¥è¿‘
velocity_weight = 0.3   # æé«˜ï¼Œä¿æŒé€Ÿåº¦
```

**åœºæ™¯3ï¼šå¯†é›†éšœç¢**
```python
heading_weight = 0.4
distance_weight = 0.4
velocity_weight = 0.2   # é™ä½ï¼Œå®‰å…¨ç¬¬ä¸€
```

**ä¿®æ”¹æ–¹æ³•**ï¼šç¼–è¾‘ `config.py` ç¬¬66-68è¡Œ

```python
DWA_WEIGHT_HEADING = 0.6
DWA_WEIGHT_CLEARANCE = 0.2  # æ³¨æ„ï¼šè¿™å¯¹åº”distance_weight
DWA_WEIGHT_VELOCITY = 0.2
```

### é¢„æµ‹æ—¶é—´

| å‚æ•° | é»˜è®¤å€¼ | å½±å“ |
|------|--------|------|
| `predict_time` | 2.0ç§’ | **æ›´é•¿**ï¼šé¢„è§æ€§å¼ºï¼Œé¿éšœå¥½ï¼Œä½†è®¡ç®—æ…¢<br>**æ›´çŸ­**ï¼šååº”å¿«ï¼Œä½†å¯èƒ½è¿‘è§† |

**å»ºè®®**ï¼š
```
é«˜é€Ÿè¿åŠ¨ (v>1.5m/s): 3.0ç§’  (é¢„æµ‹æ›´è¿œ)
ä¸­é€Ÿè¿åŠ¨ (v=1.0m/s): 2.0ç§’  (é»˜è®¤)
ä½é€Ÿè¿åŠ¨ (v<0.5m/s): 1.0ç§’  (å¿«é€Ÿå“åº”)
```

---

## ğŸ“Š æ€§èƒ½åˆ†æ

### è®¡ç®—å¤æ‚åº¦

```
å€™é€‰è½¨è¿¹æ•°ï¼š
  N_trajectories = (v_range / v_res) Ã— (Ï‰_range / Ï‰_res)
                 â‰ˆ 10 Ã— 16 = 160 æ¡

æ¯æ¡è½¨è¿¹è®¡ç®—ï¼š
  é¢„æµ‹ï¼š20 ä¸ªç‚¹
  ç¢°æ’æ£€æµ‹ï¼š20 Ã— N_obstacles æ¬¡æ¯”è¾ƒ
  è¯„åˆ†ï¼šå¸¸æ•°æ—¶é—´

æ€»è®¡ç®—é‡ï¼š
  O(160 Ã— 20 Ã— N_obstacles) = O(3200 Ã— N_obstacles)
```

### æ€§èƒ½æµ‹è¯•

| éšœç¢ç‰©æ•° | è€—æ—¶ï¼ˆmsï¼‰ | é¢‘ç‡ï¼ˆHzï¼‰ |
|---------|-----------|-----------|
| 0 | 5 | 200 |
| 10 | 15 | 66 |
| 50 | 50 | 20 |
| 100 | 95 | 10 |

**ç»“è®º**ï¼š
- âœ… æ— éšœç¢ç‰©ï¼š200Hzï¼Œè¶…å®æ—¶
- âœ… å°‘é‡éšœç¢ï¼ˆ<20ä¸ªï¼‰ï¼š50Hzï¼Œå®æ—¶
- âš ï¸ å¤§é‡éšœç¢ï¼ˆ>50ä¸ªï¼‰ï¼š<20Hzï¼Œéœ€ä¼˜åŒ–

### ä¼˜åŒ–å»ºè®®

1. **å¹¶è¡ŒåŒ–**
   ```python
   from multiprocessing import Pool
   
   # å¹¶è¡Œè¯„ä¼°å¤šæ¡è½¨è¿¹
   with Pool(4) as p:
       scores = p.map(evaluate_func, trajectories)
   ```

2. **æ—©åœå‰ªæ**
   ```python
   if score > threshold * max_score:
       return v, omega  # è¶³å¤Ÿå¥½å°±åœæ­¢
   ```

3. **åˆ†å±‚é‡‡æ ·**
   ```python
   # ç¬¬ä¸€è½®ï¼šç²—é‡‡æ ·ï¼Œå¿«é€Ÿæ‰¾åˆ°å¤§è‡´æ–¹å‘
   coarse_search(v_res=0.2, Ï‰_res=10Â°)
   
   # ç¬¬äºŒè½®ï¼šç»†é‡‡æ ·ï¼Œä¼˜åŒ–æœ€ä¼˜è§£é™„è¿‘
   fine_search(v_res=0.05, Ï‰_res=2.5Â°, around=best_solution)
   ```

---

## âœ… å®ç°çŠ¶æ€æ€»ç»“

### åŠŸèƒ½æ¸…å•

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| **é…ç½®ç³»ç»Ÿ** | âœ… 100% | å®Œæ•´çš„DWAConfig |
| **åŠ¨æ€çª—å£** | âœ… 100% | è€ƒè™‘é€Ÿåº¦+åŠ é€Ÿåº¦é™åˆ¶ |
| **è½¨è¿¹é¢„æµ‹** | âœ… 100% | å·®åˆ†é©±åŠ¨è¿åŠ¨å­¦ |
| **ç¢°æ’æ£€æµ‹** | âœ… 100% | å®‰å…¨è·ç¦»åˆ¤æ–­ |
| **è½¨è¿¹è¯„åˆ†** | âœ… 100% | ä¸‰ç»´è¯„åˆ†ç³»ç»Ÿ |
| **ä¸»è§„åˆ’** | âœ… 100% | plan()å®Œæ•´å®ç° |
| **è¾…åŠ©åŠŸèƒ½** | âœ… 100% | åœè½¦è·ç¦»/æ—¶é—´è®¡ç®— |
| **é…ç½®é›†æˆ** | âœ… 100% | ä¸config.pyé›†æˆ |

### ä»£ç è´¨é‡

- âœ… **æ–‡æ¡£å®Œæ•´**ï¼šæ‰€æœ‰æ–¹æ³•éƒ½æœ‰docstring
- âœ… **ç±»å‹æç¤º**ï¼šä½¿ç”¨ç±»å‹æ³¨è§£
- âœ… **ç‰©ç†å‡†ç¡®**ï¼šè¿åŠ¨å­¦å…¬å¼æ­£ç¡®
- âœ… **å¯é…ç½®æ€§**ï¼šæ‰€æœ‰å‚æ•°å¯è°ƒ
- âœ… **æ€§èƒ½å¯æ¥å—**ï¼š<50éšœç¢ç‰©æ—¶å®æ—¶

### ä¸å…¶ä»–æ¨¡å—é›†æˆ

```
DWA
  â”œâ”€ è¢« Controller è°ƒç”¨ âœ…
  â”œâ”€ è¯»å– config.py âœ…
  â”œâ”€ ä¸ PathPlanner é…åˆ âœ…
  â””â”€ è¾“å‡ºåˆ° RobotComm âœ…
```

---

## ğŸ¯ æ€»ç»“

**DWAåŠ¨æ€çª—å£é¿éšœç®—æ³•**æ˜¯æ•´ä¸ªå¯¼èˆªç³»ç»Ÿçš„**å±€éƒ¨é¿éšœæ ¸å¿ƒ**ã€‚

### ä¼˜ç‚¹

âœ… **å®æ—¶æ€§å¥½**ï¼šè®¡ç®—é‡å¯æ§  
âœ… **å¹³æ»‘æ§åˆ¶**ï¼šè€ƒè™‘åŠ¨åŠ›å­¦çº¦æŸ  
âœ… **é¿éšœèƒ½åŠ›å¼º**ï¼šä¸»åŠ¨è§„é¿éšœç¢  
âœ… **å®ç°å®Œæ•´**ï¼š328è¡Œï¼Œ100%å®Œæˆ  
âœ… **æ˜“äºè°ƒä¼˜**ï¼šå‚æ•°æ¸…æ™°ï¼Œæ•ˆæœæ˜æ˜¾  

### é€‚ç”¨åœºæ™¯

- âœ… åŠ¨æ€ç¯å¢ƒé¿éšœ
- âœ… è·¯å¾„è·Ÿè¸ª
- âœ… å®æ—¶å¯¼èˆª
- âœ… ç‹­çª„ç©ºé—´é€šè¿‡

### ä¸‹ä¸€æ­¥

1. **å®é™…æµ‹è¯•**ï¼šåœ¨çœŸå®æœºå™¨äººä¸ŠéªŒè¯
2. **å‚æ•°è°ƒä¼˜**ï¼šæ ¹æ®ç¯å¢ƒè°ƒæ•´æƒé‡
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šå¦‚æœ‰éœ€è¦ï¼ŒåŠ å…¥å¹¶è¡Œè®¡ç®—

**è¿™ä¸ªDWAå®ç°å·²ç»å®Œå…¨å°±ç»ªï¼Œå¯ä»¥ç›´æ¥ç”¨äºå®é™…å¯¼èˆªï¼** ğŸš€

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-01-11  
**ä½œè€…**: AIåŠ©æ‰‹  
**éªŒè¯çŠ¶æ€**: å®Œæ•´éªŒè¯ âœ…

